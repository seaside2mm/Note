

**GPU 显卡**

ls -l /dev/nv*

查看是否安装 GPU 加速卡

```c

// cudaDeviceProp deviceProp;

// CHECK(cudaGetDeviceProperties(&deviceProp, dev));

Detected 1 CUDA Capable device(s)

Device 0: "NVIDIA GeForce RTX 3080"

CUDA Driver Version / Runtime Version          11.7 / 11.7

CUDA Capability Major/Minor version number:    8.6

  

Total amount of global memory:                 10.00 MBytes (10736893952 bytes)

GPU Clock rate:                                1710 MHz (1.71 GHz)

Memory Clock rate:                             9501 Mhz

Memory Bus Width:                              320-bit

L2 Cache Size:                                 5242880 bytes

  

Max Texture Dimension Size (x,y,z)             1D=(131072), 2D=(131072,65536), 3D=(16384,16384,16384)

Max Layered Texture Size (dim) x layers        1D=(32768) x 2048, 2D=(32768,32768) x 2048

Total amount of constant memory:               65536 bytes

Total amount of shared memory per block:       49152 bytes

Total number of registers available per block: 65536

Warp size:                                     32

Maximum number of threads per multiprocessor:  1536

Maximum number of threads per block:           1024

Maximum sizes of each dimension of a block:    1024 x 1024 x 64

Maximum sizes of each dimension of a grid:     2147483647 x 65535 x 65535

Maximum memory pitch:                          2147483647 bytes

```

  
  

# debug 工具

  

- **nvcc**

`-archsm_86` : 为不同架构生成设备代码
`--device-debug (-G)` : 关闭大多数优化
`-lineinfo` : 文件名和行号关联

  

`-Xcompiler -rdynamic` : 堆栈信息

  

* cuda-gdb

焦点：cuda  thread lane warp block sm grid device kernel

检查共享内存： print *(@shared int*) 0x4

环境信息： help info cuda

  

cuda-memcheck

  

cuda-racecheck

  

* printf

  
  
  

* assert

  

# 性能分析工具
[Kernel Profiling Guide](https://docs.nvidia.com/nsight-compute/ProfilingGuide/#abstract)
## **NSight System**

<p align="center">

  <img src=" https://raw.githubusercontent.com/seaside2mm/github-photos/master/images/20230103162051.png"  width="200%"/>

  <img src=" https://raw.githubusercontent.com/seaside2mm/github-photos/master/images/20230103162130.png"  width="200%"/>

</p>

  

NVTX

</p>  <img src=" https://raw.githubusercontent.com/seaside2mm/github-photos/master/images/20230103163149.png"  width="200%"/>
</p>


  

![20230103163409]( https://raw.githubuser content. com/seaside2mm/github-photos/master/images/20230103163409. png)

The most commonly used nsys commands are:

        profile       Run an application and capture its profile into a QDSTRM file.

        launch        Launch an application ready to be profiled.

        start         Start a profiling session.

        stop          Stop a profiling session and capture its profile into a QDSTRM file.

        cancel        Cancel a profiling session and discard any collected data.

        stats         Generate statistics from an existing nsys-rep or SQLite file.

        status        Provide current status of CLI or the collection environment.

        shutdown      Disconnect launched processes from the profiler and shutdown the profiler.

        sessions list List active sessions.

        export        Export nsys-rep file into another format.

        analyze       Run rules on an existing nsys-rep or SQLITE file.

        nvprof        Translate nvprof switches to nsys switches and execute collection.

## **Nsight Compute**

-  [命令行界面](https://docs.nvidia.com/nsight-compute/2021.3/NsightComputeCli/index.html#abstract)
`$ ncu app.exe`

视频 Introduction to Kernel Performance Analysis with NVIDIA Nsight Compute  [11:59](https://www.youtube.com/watch?v=fsC3QeZHM1U)

- Nsight Compute 的使用
[22:30](https://www.youtube.com/watch?v=fsC3QeZHM1U)

**管理员模式打开 Nsight Compute**
**点击 Connection->connect**  


## **nvvp & nvprof**

nvprof 获取时间线信息，包括内核执行，内存传输以及 CUDA API 的调用等。


- nvprof

4 种模式

summary mode

trace mode

		--print-gpu-trace

		--print-api-trace

event/metric summary mode

		--metrics

event/metric trace mode

  

分析内存带宽

        全局内存访问

                加载和存储吞吐量： `gld_throughput`  `gst_throughput`

                加载和存储效率： `gld_efficientcy`  `gst_efficientcy`

        共享内存存储体冲突

                效率： `shared_efficientcy`

        寄存器溢出

        指令吞吐量

                线程束分化： `branch_efficientcy`

  
  

- 局部分析

如果只想对某一段代码进行分析，在目标代码段前后加上 `cudaProfilerStart()` 和 `cudaProfilerStop()`。

  

对于 nvvp，需要在设置中取消勾选 Start execution with profiling enabled。对于 nvprof，也有相应的参数可以配置。

  
  

